/* Copyright (c) 2011-2015 Thunderhead.com. All rights reserved. */
!function(){"use strict";window.Thunderhead=window.Thunderhead||{},window.Thunderhead.SF=window.Thunderhead.SF||{}}(),function(){"use strict";var e=window.Thunderhead.SF;_(e).extend({extend:function(e,t){return t||(t=e,e={}),e||(e={}),_(e).extend(t),e}});var t={on:function(e,t,n){return this._getEventListeners(e).push({callback:t,scope:n}),this},off:function(e,t){var n=t?function(e){return e.scope===t}:function(){return!0};return e?this._setEventListeners(e,_(this._getEventListeners(e)).reject(n)):_.chain(this._getListeners()).keys().each(_.bind(function(e){this._setEventListeners(e,_(this._getEventListeners(e)).reject(n))},this)),this},fire:function(e){var t=[];return t.push.apply(t,arguments),t.shift(),t.push(e),_(this._getEventListeners(e)).each(function(e){e.callback.apply(e.scope||this,t)}),this},_setEventListeners:function(e,t){this._getListeners[e]=t},_getEventListeners:function(e){var t=this._getListeners();return t[e]=t[e]||[],t[e]},_getListeners:function(){return this._ObservableListeners=this._ObservableListeners||{},this._ObservableListeners}};_(e).extend({mixinObservable:function(n){return e.extend(n,t)}})}(),function(){"use strict";function e(e,t,n){n||(n=t,t=[]),l[e]={moduleConstructor:n,dependencies:t},a.fire("defined",e,t)}function t(e){return e.replace(/\//g,"_").replace(/-(\w)/g,function(e){return e[1].toUpperCase()})}function n(e){var t=l[e];if(!t)throw"Failed to resolve module '"+e+"'";var n=t.dependencies,i=t.moduleConstructor,r=$.Deferred();return d.apply(this,n).done(function(){var t=i.apply(this,arguments);c[e]=t,delete l[e],r.resolve(t)}),r.promise()}function i(e){var t=u[e];if(!t){var i=$.Deferred();a.fire("loading",e),s(e).done(function(){a.fire("loaded",e),n(e).done(function(t){a.fire("created",e),delete u[e],i.resolve(t)})}),t=u[e]=i.promise()}return t}function r(e){var n=e;e=t(n),a.fire("get",e,n);var r=$.Deferred(),o=c[e];return o?(a.fire("resolved",e),r.resolve(o)):i(e).done(function(t){a.fire("resolved",e),r.resolve(t)}),r.promise()}var o=window.Thunderhead.SF,s=function(){return $.Deferred().resolve().promise()},a={setModuleConstructorLoader:function(e){s=e}};o.mixinObservable(a);var d,c={},l={},u={};d=function(){var e=Array.prototype.slice.call(arguments),t=_(e).map(function(e){return r(e)});return t.push(Thunderhead.SF),t.push(window),$.when.apply($,t)},o.require=d,o.define=e,o.moduleRegistry=a}(),Thunderhead.SF.define("browser",function(e,t){"use strict";var n=t.document;return{getCookie:function(e){var t="; "+n.cookie,i=t.split("; "+e+"=");return 2===i.length?i.pop().split(";").shift():void 0},setCookie:function(e,t){n.cookie="apex__"+e+"="+t+";secure"},getUrlParams:function(){var e={};return t.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,n,i){e[n]=i}),e},urlEncode:function(e){return encodeURIComponent(e)},redirect:function(e){t.location.href=e},redirectTop:function(e){t.top.location=e},reload:function(){t.location.reload()},getHash:function(){var e=t.location.hash;return""!==e?e:void 0},setDraftIdHash:function(e){var n=t.location.href,i="#dr"+e;t.location.replace(n.replace(t.location.hash,"")+i)},setDocboxIdHash:function(e){var n=t.location.href,i="#db"+e;t.location.replace(n.replace(t.location.hash,"")+i)},getDraftIdHash:function(){var e=t.location.hash;return e.match("^#dr")?e.substr(e.indexOf("#dr")+3):void 0},getDocboxIdHash:function(){var e=t.location.hash;return e.match("^#db")?e.substr(e.indexOf("#db")+3):void 0}}}),Thunderhead.SF.define("features",function(){"use strict";return{}}),Thunderhead.SF.define("generalSettings",function(){"use strict";return{}}),Thunderhead.SF.define("messageBroker",function(e,t){"use strict";var n=t.Thunderhead;return n.SF.MessageBroker={_subscribers:[],_registeredWindows:[],registerWindow:function(e){this._registeredWindows.push(e)},registerWindows:function(e){this._registeredWindows=this._registeredWindows.concat(e)},subscribe:function(e,t,n){n=n||this,this._subscribers[e]||(this._subscribers[e]=[]),this._subscribers[e].push(function(){return t.apply(n,arguments)})},broadcast:function(e,t){var n,i;for(n=0,i=this._registeredWindows.length;i>n;n+=1)this._registeredWindows[n].Thunderhead&&this._registeredWindows[n].Thunderhead.SF&&this._registeredWindows[n].Thunderhead.SF.MessageBroker&&this._registeredWindows[n].Thunderhead.SF.MessageBroker.publish(e,t);this.publish(e,t)},publish:function(e,t){var n=this._subscribers;if(n&&n[e]){var i,r;for(i=0,r=n[e].length;r>i;i+=1)n[e][i](t)}}},n.SF.MessageBroker}),Thunderhead.SF.define("session",function(){"use strict";return{}}),Thunderhead.SF.define("thirdParty_jQuery",function(e,t){"use strict";if(!t.$)throw"Third Party Library Missing";return t.$}),Thunderhead.SF.define("documentUploadService",["thirdParty_jQuery","messageBroker"],function(e,t){"use strict";var n=function(t,n,i,r,o,s,a){var d="."+t,c="."+n,l="."+i,u="."+r,h=a;this.subscribe(h+"/upload",function(e){e.storageLocation?this.selectFile(e.description,e.storageLocation):this.throwError("uploadStarted","A storage location must be provided")},this),this.subscribe(h+"/deleteDoc",function(e){e.docId?this.deleteDocument(e.docId):this.throwError("deleted","A document id must be provided")},this),this.startUpload=function(t){var n=t.split("\\"),i=n[n.length-1];this.broadcast(h+"/uploadStarted",{event:{status:!0},params:{docName:i}}),e(c).click()},this.selectFile=function(){e(d).click()},this.deleteDocument=function(t){e(l).val(t),e(u).click()},this.finishUpload=function(e,t){this.broadcast(h+"/uploaded",{event:{status:!0},params:{docId:e,docName:t}})},this.acknowledgeDelete=function(e){this.broadcast(h+"/deleted",{event:{status:!0},params:{docId:e}})},this.throwError=function(e,t,n){this.broadcast(h+"/"+e,{event:{status:!1,message:t,details:n}})}};return n.prototype=t,n}),Thunderhead.SF.define("fileUploader",["thirdParty_jQuery","messageBroker"],function(e,t,n,i){"use strict";var r=function(t){var n,r=t.serviceId||"defaultService",o=t.fileObjectType||"document",s=t.iframeContainerId||"uploadContainer",a=t.storageLocation;if(!a)throw{name:"File Uploader Error",message:"Invalid argument: Storage Location",toString:function(){return this.name+": "+this.message}};n="apex/COMMON_UploadService?uploadObjType="+encodeURIComponent(o)+"&serviceId="+encodeURIComponent(r)+"&storageLocation="+encodeURIComponent(t.storageLocation)+"&description="+encodeURIComponent(t.fileDescription);var d='<iframe src="'+n+'" id="'+r+'" name="'+r+'" frameBorder="0" style="height: '+t.buttonHeight+";width: "+t.buttonWidth+'" /><div id="'+r+'UploadingButtonSpacing" style="width: '+t.buttonWidth+';display: none;"><input class="skywalker_button" id="'+r+'UploadingButton" disabled="disabled" type="button" style="display:none;" value="From My Computer" /></div>';e("#"+s).append(d),this.registerWindow(i.frames[r]);var c=function(t){t.event.status===!0&&(e("#"+r).css("display","none"),e("#"+r+"UploadingButton").css("display","inline"),e("#"+r+"UploadingButtonSpacing").css("display","inline-block"))};this.subscribe(r+"/uploadStarted",c,this);var l=function(){e("#"+r).css("display","inline"),e("#"+r+"UploadingButton").css("display","none"),e("#"+r+"UploadingButtonSpacing").css("display","none")};this.subscribe(r+"/uploaded",l,this),this.subscribe(r+"/deleted",l,this),this.registerFileSelectionCallback=function(e,t){this.subscribe(r+"/uploadStarted",e,t)},this.registerUploadedCallback=function(e,t){this.subscribe(r+"/uploaded",e,t)},this.registerFileDeletedCallback=function(e,t){this.subscribe(r+"/deleted",e,t)},t.fileSelectionCallback&&this.registerFileSelectionCallback(t.fileSelectionCallback,t.fileSelectionScope),t.fileUploadedCallback&&this.registerUploadedCallback(t.fileUploadedCallback,t.fileUploadedScope),t.deletedCallback&&this.registerFileDeletedCallback(t.deletedCallback,t.deletedScope),this.openFileUploadDialog=function(e,t){this.broadcast(r+"/upload",{description:e,storageLocation:t})},this.deleteFile=function(e){c({event:{status:!0}}),this.broadcast(r+"/deleteDoc",{docId:e})},this.cancelUpload=function(){l(),e("#"+r).attr("src",n)}};return r.prototype=t,r}),Thunderhead.SF.define("thirdParty_mustache",function(e,t){"use strict";if(!t.Mustache)throw"Third Party Library Missing";return t.Mustache}),Thunderhead.SF.define("thirdParty_underscore",function(e,t){"use strict";if(!t._)throw"Third Party Library Missing";return t._}),Thunderhead.SF.define("docedt_dialogMessages",["thirdParty_jQuery","thirdParty_underscore","thirdParty_mustache"],function(e,t,n){"use strict";function i(t){return e("#"+t+"_tmpl").html()}var r=function(e){this.$messages=e};return t(r.prototype).extend({_show:function(t,r,o){var s=n.render(i("message"),{id:o||r,alert:r,message:t});return e(s).appendTo(this.$messages)},addWarning:function(e,t){this._show(e,"warning",t).find(".close").hide()},addError:function(e){this._show(e,"danger")},clear:function(){this.$messages.empty()},clearError:function(e){e?this.$messages.find(".message-"+e).remove():this.$messages.find(".message-danger").remove()},clearWarning:function(e){e?this.$messages.find(".message-"+e).remove():this.$messages.find(".message-warning").remove()}}),r}),Thunderhead.SF.define("docedt_documentDialog",["thirdParty_jQuery","thirdParty_underscore","thirdParty_mustache","docedt_dialogMessages"],function(e,t,n,i,r){"use strict";function o(t){return e("#"+t+"_tmpl").html()}var s=function(e,t,n){this._id="document_dialog_"+e,this._isEditMode=n,this._inititiate(t)};return r.mixinObservable(s.prototype),s.prototype.show=function(){e("#"+this._id).modal("show")},s.prototype.hideStorage=function(){e(".storageName").remove()},s.prototype.setDocProperties=function(e){this.showStorage(e)},s.prototype.showStorage=function(t){var n="storageName",i=e("."+n+"-input");i.blur(function(e){t.set(n,e.target.value)}).val(t.get(n)),i.prop("disabled",!this._isEditMode)},s.prototype._inititiate=function(r){var s=this;e(n.render(o("document-modal"),{id:this._id})).appendTo(r),e("#"+this._id+" .close-modal").click(t.debounce(t(this._close).bind(this),1e3,!0)),this._messages=new i(e("#"+this._id+" .messages")),e("#"+this._id).keyup(function(e){27===e.which&&(e.preventDefault(),s._close())})},s.prototype._close=function(){var n=this._validateInputs();if(0!==n.length){var i="The following errors were found. Please correct them before continuing.<br/><br/>";t(n).each(function(e){i=i+"• "+e}),this._messages.clearError(),this._messages.addError(i)}else e("#"+this._id).modal("hide"),this._messages.clear(),e("#"+this._id+" div").removeClass("has-error"),this.fire("close")},s.prototype._validateInputs=function(){var n=[],i={storageName:"Storage Name cannot be empty."},r=this;return t(i).each(function(t,i){var o="#"+r._id+" div."+i;if(e(o+" input").is(":visible")){var s=e.trim(e(o+" input").val()).length;0===s&&(n.push(t),e(o).addClass("has-error"))}}),n},s}),Thunderhead.SF.define("models",["thirdParty_underscore"],function(e,t){"use strict";var n,i={};n=i.Collection=function(e){return this instanceof n?void this.push.apply(this,e||[]):new n(e)},n.prototype=[],n.prototype.__Collection=!0,t.mixinObservable(n.prototype),e(["pop","push","reverse","shift","sort","splice","unshift"]).each(function(e){n.prototype[e]=function(){var t=Array.prototype[e].apply(this,arguments);return this.fire("change"),t}}),n.prototype.set=function(e){Array.prototype.splice.call(this,0,this.length),Array.prototype.push.apply(this,e),this.fire("change")},n.prototype.pushAll=function(e){this.push.apply(this,e)},e(["each","map","reduce","reduceRight","find","filter","reject"]).each(function(t){n.prototype[t]=n.prototype[t]||function(){var n=[this];return n.push.apply(n,arguments),e[t].apply(e,n)}}),n.prototype.rejectInplace=function(e){return this.set(this.reject(e)),this},n.prototype.filterInplace=function(e){return this.set(this.filter(e)),this};var r=function(){};return t.mixinObservable(r.prototype),r.prototype.get=function(e){return this._val[e]},r.prototype.set=function(e,t,n){var i=this._val[e];if(this._val[e]=t,i&&i.__Collection&&t!==i&&(i.off("change","__set_"+e),t&&t.__Collection)){var r=this;t.on("change",function(){r.__fireSetEvents(e,t)},"__set_"+t)}n&&n.silent||t===i||this.__fireSetEvents(e,t)},r.prototype.__fireSetEvents=function(e,t){this.fire("set:"+e,t),this.fire("set",e,t)},r.prototype.val=function(){return e(this._val).clone()},i.extend=function(n){n=n||{};var i=n.defaults||{};e(i).isFunction()&&(i=i());var o=n.initializer||function(){},s=function(t){if(!(this instanceof s))return new s(t);var n=this;t=t||{},this._val={},e.chain(i).clone().extend(t).each(function(e,t){n.set(t,e),e&&e.__Collection&&e.on("change",function(){n.__fireSetEvents(t,e)},"__set_"+e)}),o.call(this)};return t.extend(s.prototype,new r),s},i.DTO=function(t,n,i,r){t._DTOBinding=e(n).clone(),t.fromDTO=function(n){var r=e(t._DTOBinding).reduce(function(t,i,r){var o=n[r];return e(o).isNull()||e(o).isUndefined()||(i===!0?t[r]=o:e(i).isString()?t[i]=o:i.fromDTO(t,o,r)),t},{});return i&&e(r).extend(i(n)),t(r)},t.prototype.toDTO=function(){var n=this,i=e(t._DTOBinding).reduce(function(t,i,r){var o;return o=i===!0?n.get(r):e(i).isString()?n.get(i):i.toDTO(n,r),e(o).isNull()||e(o).isUndefined()||(t[r]=o),t},{});return r&&e(i).extend(r.call(this)),i}},i}),Thunderhead.SF.define("docedt_documentModels",["models"],function(e){"use strict";var t,n={};return t=n.Document=e.extend(),e.DTO(t,{id:!0,name:!0,contentType:!0,storageLocation:"folderId"}),n}),Thunderhead.SF.define("docedt_emailModels",["thirdParty_underscore","models","docedt_documentModels"],function(e,t,n){"use strict";var i,r,o=t.Collection,s={};return i=s.Email=t.extend({defaults:function(){return{attachments:new o}}}),r=s.EmailAttachment=t.extend({defaults:{type:1,retainedReference:!1,isInaccessible:!1}}),i.prototype.getAttachment=function(e){return this.get("attachments")[e]},i.prototype.getAttachmentByDocumentName=function(t){return e(this.get("attachments")).find(function(e){return e.get("document").get("name")===t})},i.prototype.addAttachment=function(){var e=this.get("attachments");return e.push.apply(e,arguments)},i.prototype.removeAttachment=function(e){var t=this.get("attachments").indexOf(e);t>-1&&this.get("attachments").splice(t,1)},e(r).extend({SALESFORCE_DOCUMENT:1,LOCAL_ATTACHMENT:2,DRAFT_ATTACHMENT:3,OBJECT_ATTACHMENT:4,createDraftAttachment:function(e){return e.type=r.DRAFT_ATTACHMENT,new r(e)},createObjectAttachment:function(e){return e.type=r.OBJECT_ATTACHMENT,new r(e)}}),r.prototype.isSalesforceDocument=function(){return r.SALESFORCE_DOCUMENT===this.get("type")},t.DTO(i,{subject:!0,fromAddress:"from",toAddresses:"to",ccAddresses:"cc",bccAddresses:"bcc",toTargetObjectName:!0,toTargetObjectId:!0},function(t){var n=t.draftAttachments,i={};if(n){var s=[];e(n).each(function(e){s.push(r.fromDTO(e))}),i.attachments=new o(s)}return i},function(){var e=[];return this.get("attachments").each(function(t){e.push(t.toDTO())}),{draftAttachments:e}}),t.DTO(r,{attachmentRefId:"id",attachmentType:"type",retainedReference:!0,isInaccessible:!0},function(e){return{document:n.Document.fromDTO(e)}},function(){return this.get("document").toDTO()}),s}),Thunderhead.SF.define("docedt_storageModels",["models"],function(e){"use strict";var t,n={};return t=n.Storage=e.extend(),e.DTO(t,{allowStorageNameChange:!0,storageName:!0}),n}),Thunderhead.SF.define("docedt_draftModels",["models","docedt_emailModels","docedt_storageModels"],function(e,t,n,i){"use strict";var r,o={};return r=o.Draft=e.extend(),i.extend(r.prototype,{isEditMode:function(){var e=this.get("status");return!("Finalised"===e||"Final"===e||this.isApproved())},requiresApproval:function(){return this.get("approvalRequired")},isPreApproval:function(){return this.requiresApproval()&&"Pre-approved"===this.get("approvalStatus")},isPendingApproval:function(){return this.requiresApproval()&&"Pending"===this.get("approvalStatus")},isApproved:function(){return this.requiresApproval()&&"Approved"===this.get("approvalStatus")},isRejected:function(){return this.requiresApproval()&&"Rejected"===this.get("approvalStatus")},isRemoved:function(){return this.requiresApproval()&&"Removed"===this.get("approvalStatus")}}),e.DTO(r,{id:!0,xml:!0,documentTitle:!0,name:!0,attachmentId:!0,docSettingId:!0,primaryObjectId:!0,primaryObjectName:!0,canGenerate:!0,canCollaborate:!0,status:!0,canDelete:!0,canRevise:!0,lastModified:!0,approvalRequired:!0,approvalStatus:!0},function(e){var i={};return e.emailInfo&&(i.emailInfo=t.Email.fromDTO(e.emailInfo)),i.storageInfo=n.Storage.fromDTO(e.storageInfo),i},function(){var e={};return this.get("emailInfo")&&(e.emailInfo=this.get("emailInfo").toDTO()),e.storageInfo=this.get("storageInfo").toDTO(),e}),o}),Thunderhead.SF.define("salesforce1_jobMessages",["thirdParty_jQuery","thirdParty_mustache","thirdParty_underscore"],function(e,t,n,i){"use strict";function r(e){return{type:a[e.MessageType],text:e.MessageText}}function o(i){return this instanceof o?(this.$=e(t.render(s,{messages:n(i).map(r)})),this.$.find(".back-button").click(n(this.fire).bind(this,"back")),void this.$.find(".continue-button").click(n(this.fire).bind(this,"continue"))):new o(i)}var s=e("#salesforce1-job-messages_tmpl").text(),a={I:{label:"Info",style:"info"},W:{label:"Warning",style:"warning"},E:{label:"Error",style:"danger"}};return o.prototype.toggleButtons=function(){var e=arguments;n(["back","continue"]).each(function(t){var n=this.$.find("."+t+"-button");n.toggle.apply(n,e)},this)},i.mixinObservable(o.prototype),o}),Thunderhead.SF.define("salesforce1_messages",["thirdParty_jQuery","thirdParty_mustache","thirdParty_underscore"],function(e,t,n,i){"use strict";function r(i){return this instanceof r?(this.$=e(t.render(o,{message:i})),void this.$.find(".back-button").click(n(this.fire).bind(this,"back"))):new r(i)}var o=e("#salesforce1-messages_tmpl").text();return r.prototype.toggleButtons=function(){var e=this.$.find(".back-button");e.toggle.apply(e,arguments)},i.mixinObservable(r.prototype),r}),Thunderhead.SF.define("thunderhead",function(e,t){"use strict";return t.Thunderhead}),Thunderhead.SF.define("ui_dropdown",["thirdParty_jQuery","thirdParty_mustache","generalSettings"],function(e,t,n){"use strict";return function(i,r,o,s){if(n.orgIsChatterEnabled){r.addClass("drop_down_area");var a=t.render(e("#dropdown-button_tmpl").html(),{id:i,buttonLabel:s,menuClass:o}),d=e(a);e("#"+i).replaceWith(d),d.click(function(){var t=d.position().left,n=d.position().top+25;r.css({position:"absolute",top:n+"px",left:t+"px"});var i=r.is(":visible");e(".drop_down_area:visible").each(function(t,n){e(n).hide()}),i||r.show()})}}}),Thunderhead.SF.define("ui_jobMessages",["thirdParty_jQuery","thirdParty_mustache"],function(e,t,n){"use strict";var i={_container:null,_hasErrors:!1,_tableTemplate:'<div class="bPageBlock brandSecondaryBrd apexDefaultPageBlock secondaryPalette"><div class="pbHeader"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="pbTitle">&nbsp;</td><td><input class="btn back-button" value="Back" type="button"/>{{#noErrors}}<input class="btn continue-button" value="Continue" type="button"/>{{/noErrors}}</td></tr></tbody></table></div><div class="pbBody"><div><table class="list" border="0" cellpadding="0" cellspacing="0" style="width:100%;"><thead class="rich-table-thead"><tr class="headerRow"><th class="headerRow">Type</th><th class="headerRow">Messages</th></tr></thead><tbody>{{#messages}}<tr class="row1"><td class="col_type" align="left" width="200px">{{MessageTypeLabel}}</td><td class="col_message">{{{MessageText}}}</td></tr>{{/messages}}</tbody></table></div></div><div class="pbBottomButtons"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="pbTitle">&nbsp;</td><td><input class="btn back-button" value="Back" type="button"/>{{#noErrors}}<input class="btn continue-button" value="Continue" type="button" />{{/noErrors}}</td></tr></tbody></table></div></div>',_getMessageType:function(e){var t;for(t=0;t<e.length;t+=1)e[t].MessageType===i._messageTypeInfo?e[t].MessageTypeLabel="Info":e[t].MessageType===i._messageTypeWarning?e[t].MessageTypeLabel="Warning":e[t].MessageType===i._messageTypeError&&(e[t].MessageTypeLabel="Error",this._hasErrors=!0);return e},continueProcess:function(){this.clearContainer(),this.fire("MESSAGES_CONTINUE")},back:function(){this.fire("MESSAGES_BACK")},clearContainer:function(){this._container&&this._container.empty()},getMessageTable:function(n,i){n=this._getMessageType(n);var r={messages:n,noErrors:!this._hasErrors},o=t.render(this._tableTemplate,r),s=e(o);return s.find(".back-button").click(e.proxy(this.back,this)),s.find(".continue-button").click(e.proxy(this.continueProcess,this)),i&&(this._container=e(i),this._container.empty(),s.appendTo(i)),s}};return n.extend(i,{_messageTypeInfo:"I",_messageTypeWarning:"W",_messageTypeError:"E"}),n.mixinObservable(i),i}),Thunderhead.SF.define("ui_messages",["thirdParty_mustache"],function(e){"use strict";return{_messageTmpl:null,buildWarningHtml:function(e,t){return this._getMessageHtml("WARNING",e,t)},buildErrorHtml:function(e){return this._getMessageHtml("ERROR",e)},buildErrorListHtml:function(e){return this._getMessageHtml("ERROR",void 0,e)},buildSuccessHtml:function(e){return'<img alt="saved" src="/img/msg_icons/confirm24.png">'+e},_getMessageHtml:function(t,n,i){var r,o,s=this._getMessageTmpl();"ERROR"===t?(o="color:#cc0000",r=n?"Error:":"Errors"):(o="",r=n?"Warning:":"Warnings");var a={levelM3:"ERROR"===t?"errorM3":"warningM3",level:t,messageTextStyle:o,messageLevel:r,message:void 0!==n?n:"",messages:i,hasMessages:i&&i.length>0};return e.render(s,a)},_getMessageTmpl:function(){return this._messageTmpl?this._messageTmpl:(this._messageTmpl='<div class="message {{levelM3}}" role="alert"><table border="0" cellpadding="0" cellspacing="0" class="messageTable" style="padding:0px;margin:0px;"><tbody><tr valign="top"><td><img alt="{{level}}" class="msgIcon" src="/s.gif" title="{{level}}"></td><td class="messageCell"><div class="messageText"><span style="{{messageTextStyle}}"><h4>{{messageLevel}}</h4></span>{{{message}}}<br></div></td></tr><tr><td></td><td>{{#hasMessages}}<span><ul style="padding-left:10px;padding-top:0px;margin:0px">{{#messages}}<li style="padding-top:5px">{{{.}}}</li>{{/messages}}</ul></span>{{/hasMessages}}</td></tr></tbody></table></div>',this._messageTmpl)}}}),Thunderhead.SF.define("ui_resize",function(e,t){"use strict";var n=function(e,n){this._el=t.document.getElementById(e),this._headerHeight=this._getAbsoluteTop(this._el),this._footerHeight=n};return e.extend(n,{DEFAULT_FOOTER_HEIGHT:85,CONSOLE_FOOTER_HEIGHT:0}),n.prototype={_el:null,_headerHeight:0,_footerHeight:0,_getAbsoluteTop:function(e){for(var t=0;e&&null!==e;)t+=e.offsetTop,e=e.offsetParent;return t},resizeElement:function(){var e=t.document.documentElement.clientHeight,n=e-this._getAbsoluteTop(this._el)-this._footerHeight;this._el.style.height=n+"px"}},n}),Thunderhead.SF.define("ui_spinner",function(){"use strict";return{html:'<img src="/img/loading.gif" width="15px" height="15px" />'}}),Thunderhead.SF.define("visualforce_remotingManager",function(e,t){"use strict";return t.Visualforce.remoting.Manager}),Thunderhead.SF.define("remoteActions",["thirdParty_underscore","thirdParty_jQuery","visualforce_remotingManager","generalSettings"],function(e,t,n,i,r,o){"use strict";function s(e){var t="Logged in?";return"parse"===e.code&&-1!==e.message.indexOf(t,e.message.length-t.length)}function a(r,a,c){return function(){var l,u=t.Deferred(),h=e(arguments).map(function(t){return e.isUndefined(t)?null:t});l=e.isFunction(e.last(h))?h.pop():function(){};var f=function(e,t){l.call(this,e,t),t.status?u.resolve(e,t):s(t)?(o.console&&o.console.error&&o.console.error("Salesforce session expired"),d.fire("session-expired")):u.reject(t)};h.push(f);var p=[i.namespace,r,a].join("."),_=[p].concat(h);c&&_.push(c);try{n.invokeAction.apply(n,_)}catch(g){u.reject(g)}return u.promise()}}var d=r.mixinObservable({sessionExpired:"session-expired"}),c={events:d,createRemoteActions:function(t,n){var i={events:d};return e.isArray(n)?e(n).reduce(function(e,n){return e[n]=a(t,n),e},i):e(n).reduce(function(e,n,i){return e[i]=a(t,i,n),e},i)}};return c}),Thunderhead.SF.define("docedt_remoteDocuments",["remoteActions"],function(e){"use strict";return e.createRemoteActions("REMOTE_CO_Documents",["getDocumentFolders","getDocumentsByFolderId","getWrappedDocuments","getDocuments"])}),Thunderhead.SF.define("docedt_emailAttachmentsDialog",["thirdParty_jQuery","thirdParty_underscore","thirdParty_mustache","ui_spinner","docedt_remoteDocuments"],function(e,t,n,i,r,o){"use strict";function s(t){return e("#"+t).html()}function a(t){e("#documents-table").empty().append("<h4>"+t.message+"</h4>")}var d=function(t,n){var i=this;o.extend(this,n),this._id=t+"_modal",e(s("doc_modal_tmpl")).appendTo(this.parent).attr("id",this._id),e("#th_btn_attachdocs").click(function(){r.getDocuments(i.selectedDocs).done(function(t){e("#"+i._id).modal("hide"),i.fire("SELECTED",t)}).fail(a)})};return o.mixinObservable(d.prototype),o.extend(d.prototype,{sizeLimit:null,maxDocuments:500,show:function(t){var n=this;e("#documents-table").empty(),this.selectedDocs=[],r.getDocumentFolders().pipe(function(i){n._renderFolders(i),n._showSpinner();var o=e("#"+n._id+" .th_select_folder").find(":selected").val();return r.getWrappedDocuments(o,t)}).done(function(e){n._renderDocuments(e)}).fail(a),this.selectedDocs.push.apply(this.selectedDocs,t),e("#"+this._id).modal("show")},_renderFolders:function(t){var i=n.render(s("folder-dropdown_tmpl"),{folders:t});e("#folder-list").empty().append(i);var r=this;e("#"+r._id+" .th_select_folder").change(function(){r._changeFolder()})},_renderDocuments:function(i){var r=this,o=!1;if(i.length>this.maxDocuments)return void e("#documents-table").empty().append("<h4><p>Too many documents in this folder.</p><p>The maximum is "+this.maxDocuments+". This folder contains "+i.length+" documents.</p><h4>");var a={documents:i,documentRowCls:function(){return this.Doc.Name.replace(" ","_")},date:function(){var e=new Date(this.Doc.LastModifiedDate),t=e.getDate();t=10>t?"0"+t:t;var n=e.getMonth()+1;n=10>n?"0"+n:n;var i=e.getFullYear();return t+"/"+n+"/"+i},size:function(){var e=this.Doc.BodyLength/1024;return e>=1024?(e/1024).toFixed(1)+"M":Math.ceil(e)+"K"}};if(null!==r.sizeLimit){var d=function(e){return e.Doc.BodyLength>=r.sizeLimit};o=t(i).find(d),a.isSelectable=function(){return!d(this)}}else a.isSelectable=!0;var c=n.render(s("docs-table_tmpl"),a),l=e("#documents-table").empty();o&&l.append('<p class="text-warning">Documents greater than 5MB are not supported</p>'),l.append(c),e(".document-check").each(function(t,n){var i=e(n).data("id");e(n).click(function(e){var t=e.currentTarget.checked;r._documentSelected(t,i)})})},_changeFolder:function(){var t=e("#"+this._id+" .th_select_folder").find(":selected").val(),n=this;this._currentFolderId=t,this._showSpinner(),r.getWrappedDocuments(t,this.selectedDocs).done(function(e){t===n._currentFolderId&&n._renderDocuments(e)}).fail(function(e){t===n._currentFolderId&&a(e)})},_documentSelected:function(t,n){if(t)this.selectedDocs.push(n);else{var i=e.inArray(n,this.selectedDocs);-1!==i&&this.selectedDocs.splice(i,1)}},_showSpinner:function(){e("#documents-table").empty().append(e(i.html))}}),d}),Thunderhead.SF.define("docedt_remoteDrafts",["thirdParty_jQuery","remoteActions","generalSettings","session"],function(e,t,n,i){"use strict";function r(t){return e.Deferred().reject(t).promise()}function o(t){var n=d+t.id+a+t.attachmentId,o=function(e){e.setRequestHeader("SalesforceProxy-Endpoint",n),e.setRequestHeader("Authorization"," OAuth "+i.sessionId)},s=JSON.stringify({lastmodified:t.lastModified,draftxml:t.xml,emailInfo:t.emailInfo,storageInfo:t.storageInfo});return s.length<25e5?e.ajax({type:"PUT",url:c,cache:!1,contentType:"application/json",processData:!1,dataType:"json",data:s,beforeSend:o}).pipe(function(e){return e},function(e,t,n){return{message:t+" "+n}}):r(l)}function s(e){return h(e).pipe(function(e){return e},function(t){return t.message&&-1!==t.message.toLowerCase().indexOf("input too long")?o(e):t})}var a="/attachment/",d="https://"+n.serverInstance+".salesforce.com/services/apexrest/"+n.namespace+"/draft/",c="https://"+n.namespace+"."+n.serverInstance+".visual.force.com/services/proxy",l={name:"Draft Service Error",message:"The draft that you have generated exceeds the Salesforce size limits. If the draft contains images, consider reducing the resolution or number of images in your draft, or move the images to the Template or Shared Content.",toString:function(){return this.name+": "+this.message}},u=t.createRemoteActions("REMOTE_CO_Drafts",{getDraft:{escape:!1},getDraftObject:{escape:!1},getEmailHeaderInfo:{escape:!0},getStorageInfo:{escape:!0},reviseDraft:{escape:!0},deleteDraft:{escape:!0},saveDraft:{escape:!0},saveDraftObject:{escape:!0},submitForApproval:{escape:!0}}),h=u.saveDraftObject;return u.saveDraft=function(e){return e.xml.length<98e4?s(e):e.xml.length<25e5?o(e):r(l)},u}),Thunderhead.SF.define("docedt_approvalProcess",["thirdParty_jQuery","browser","docedt_remoteDrafts","ui_messages"],function(e,t,n,i,r){"use strict";var o="#approval-process-related-list",s={init:function(t,n){n=r.extend({relatedListTarget:null,submitButton:null},n),this.relatedListTarget=n.relatedListTarget,t.isPreApproval()&&e(n.submitButton).show().click(function(){s.fire("SUBMIT")}),t.isPreApproval()||(t.isRejected()||e(n.submitButton).hide(),e(o).detach().appendTo(n.relatedListTarget).show()),e(n.relatedListTarget).show()},emptyList:function(){e(o).empty()}};return r.mixinObservable(s),s}),Thunderhead.SF.define("docgen_remoteDocbox",["remoteActions"],function(e){"use strict";return e.createRemoteActions("REMOTE_CO_Docbox",["loadDocbox"])}),Thunderhead.SF.define("remoteDocumentGenerator",["remoteActions"],function(e){"use strict";var t={escape:!1};return e.createRemoteActions("REMOTE_CO_DocumentGenerator",{generate:t,generateWithContext:t,processDocumentPackage:t,finaliseDraft:t})}),Thunderhead.SF.define("documentProcessor",["thirdParty_jQuery","browser","remoteDocumentGenerator"],function(e,t,n,i,r){"use strict";var o={generationContext:null,isGenerated:function(e){var n=!1;return e&&(t.getCookie("apex__genId"+e)?n=!0:r.document.cookie="apex__genId"+e+"=1;secure"),n},getGenerationContext:function(){return o.generationContext},nextAction:function(e){e?o.generationContext=e:e=o.generationContext,o.fire(e.nextAction.toUpperCase(),e)},_createDocumentGeneratorCallback:function(e){return function(t,n){n.status?(o.generationContext=t,e.resolve(t)):e.reject(t,n)}},generate:function(t){t?o.generationContext=t:t=o.generationContext;var i=e.Deferred();return t.draftRecordId?i.resolve(t):n.generateWithContext(t,o._createDocumentGeneratorCallback(i)),i.promise()},processDocumentPackage:function(){var t=e.Deferred();return n.processDocumentPackage(o.generationContext,o._createDocumentGeneratorCallback(t)),t.promise()},finaliseDraft:function(t,i){var r=e.Deferred();return r.done(function(e){o.generationContext=e,o.fire("DRAFT_FINALISED",e)}),o.generationContext.collaborate=!!t,o.generationContext.lastModified=i,n.finaliseDraft(o.generationContext,o._createDocumentGeneratorCallback(r)),r.done(function(e){o.generationContext=e,o.nextAction(e)}),r.promise()},complete:function(){this.fire("COMPLETE",o.generationContext)},echoSign:function(){this.fire("ECHOSIGN",o.generationContext)}};return i.mixinObservable(o),o}),Thunderhead.SF.define("docgen_echosign",["browser","documentProcessor"],function(e,t){"use strict";t.on("ECHOSIGN",function(t){e.redirect(decodeURIComponent(t.echosignUrl))})}),Thunderhead.SF.define("publisherActionWidget",["thirdParty_jQuery","thirdParty_underscore","remoteDocumentGenerator","generalSettings","session","ui_messages","ui_jobMessages","browser"],function(e,t,n,i,r,o,s,a){"use strict";function d(e){return function(t){return t[e]}}var c={edit:{page:"DOCEDT_EditDocument",visible:d("canEdit")},generate:{page:"DOCGEN_GenerateDocument",visible:d("canGenerate")},collaborate:{page:"COLLAB_Docbox",visible:d("canCollaborate")}},l=function(n,i){var r=this;
this._objectId=n,this._docSettings=i,t(i).keys().length>0?(e("#th-gen-controls select").change(function(){r._onDocSettingsSelected()}),t(c).each(function(t,n){e("#th_btn_"+n).click(function(){r._generate(n,t.page)})})):(e("#th-gen-controls").hide(),e("#th-gen-error-message").html("No documents for this page"),e("#th-gen-error").show()),e("#th-gen-controls select").change(function(){r._onDocSettingsSelected()}),t(c).each(function(t,n){e("#th_btn_"+n).click(function(){r._generate(n,t.page)})}),this._onDocSettingsSelected(),e("#th_widget").show()};return l.prototype={_generate:function(e,t){var n=this._getSelectedDocumentSettingsId(),r=Math.floor(1e7*Math.random()),o="/apex/"+i.orgNamespace+t+"?action="+e+"&objectId="+this._objectId+"&docSettingId="+n+"&genId="+r;return a.redirectTop(o),!1},_onDocSettingsSelected:function(){var n=this._getSelectedDocumentSettingsId(),i=this._docSettings[n];t(c).each(function(t,n){var r=e("#th_btn_"+n);t.visible(i)?r.show():r.hide()})},_getSelectedDocumentSettingsId:function(){return e(".th-select-docsettings").val()}},l}),Thunderhead.SF.define("remote_attachments",["remoteActions"],function(e){"use strict";return e.createRemoteActions("REMOTE_CO_Attachments",["getAttachments"])}),Thunderhead.SF.define("docedt_attachmentsDialog",["thirdParty_jQuery","thirdParty_underscore","thirdParty_mustache","ui_spinner","remote_attachments"],function(e,t,n,i,r,o){"use strict";function s(){}function a(t){return e("#"+t).html()}function d(e,t){return e.length>t?e.substring(0,t-3)+"...":e}var c=function(t,i,r){var s=this;this._id="attachments-dialog-"+t,this._primaryObject=i,o.extend(this,r),this._selected={},e(n.render(a("attachments-dialog_tmpl"),{primaryObject:d(i.name)})).appendTo(r.parent).attr("id",this._id),this._getEl("ok").click(function(){e("#"+s._id).modal("hide");var t=s._getSelectedAttachments();s.fire("SELECTED",t)})};return o.mixinObservable(c.prototype),o.extend(c.prototype,{sizeLimit:null,maxAttachments:500,show:function(){var n=this;this._getEl("attachments-table").empty(),this._selected={},this._showSpinner(),r.getAttachments(this._primaryObject.id).done(function(e){n._attachments=t(e).sortBy("CreatedDate"),n._renderAttachments()}).fail(s),e("#"+this._id).modal("show")},_renderAttachments:function(){var i=this,r=this._attachments,o=!1;if(r.length>this.maxAttachments)return this._getEl("attachments-table").empty().append("<h4><p>The Primary Object has too many attachments.</p><p>The maximum is "+this.maxAttachments+". This Object has "+r.length+" attachments.</p><h4>");var s={attachments:r,attachmentRowCls:function(){return this.Name.replace(" ","_")},date:function(){var e=new Date(this.CreatedDate),t=e.getDate();t=10>t?"0"+t:t;var n=e.getMonth()+1;n=10>n?"0"+n:n;var i=e.getFullYear();return t+"/"+n+"/"+i},size:function(){var e=this.BodyLength/1024;return e>=1024?(e/1024).toFixed(1)+"M":Math.ceil(e)+"K"}};if(null!==i.sizeLimit){var d=function(e){return e.BodyLength>=i.sizeLimit};o=t(r).find(d),s.isSelectable=function(){return!d(this)}}else s.isSelectable=!0;var c=n.render(a("attachments-dialog-table_tmpl"),s),l=this._getEl("attachments-table").empty();o&&l.append('<p class="text-warning">Attachments greater than 5MB are not supported</p>'),l.append(c),e(".attachment-check").each(function(t,n){var r=e(n).data("id");e(n).click(function(e){i._selected[r]=!!e.currentTarget.checked})})},_getSelectedAttachments:function(){return t(this._attachments).reduce(function(e,t){return this._selected[t.Id]&&e.push(t),e},[],this)},_showSpinner:function(){this._getEl("attachments-table").empty().append(e(i.html))},_getEl:function(t){return e("#"+this._id+" ."+t)}}),c}),Thunderhead.SF.define("docedt_emailDialog",["thirdParty_jQuery","thirdParty_underscore","thirdParty_mustache","fileUploader","docedt_documentModels","docedt_emailModels","docedt_attachmentsDialog","docedt_emailAttachmentsDialog","docedt_dialogMessages"],function(e,t,n,i,r,o,s,a,d,c,l){"use strict";function u(t){return e("#"+t+"_tmpl").html()}var h=5242880,f=r.Document,p=o.EmailAttachment,_=function(){this._id=0,this._current=null};t(_.prototype).extend({start:function(e){return this._id=this._id+1,this._current={name:e,id:this._id},this._current},isUploading:function(){return!!this._current},get:function(){return this._current},stop:function(){var e=this._current;return this._current=null,e}});var g=function(e,t,n,i){this._id="email_dialog_"+e,this.parent=n.parent,this._uploading=new _,this._docsToDelete={},this._isEditMode=i,this._inititiate(n),this.setEmail(t,i)};return c.mixinObservable(g.prototype),g.prototype._addUploading=function(e){this.fire("uploading",!0,e),this._uploading.start(e)},g.prototype._removeUploading=function(){var e=this._uploading.stop();return this.fire("uploading",!1,e.name),e},g.prototype.show=function(){this._renderAddresses(),this._renderAttachments(),e("#"+this._id).modal("show")},g.prototype.hideStorage=function(){e(".storageName").remove()},g.prototype.showStorage=function(t){var n="storageName",i=e("."+n+"-input");i.blur(function(e){t.set(n,e.target.value)}).val(t.get(n)),i.prop("disabled",!this._isEditMode)},g.prototype.setEmail=function(n,i){i!==this._isEditMode&&(this._isEditMode=i);var r=this;if(n&&n!==this._email){this._email&&(this._email.off(null,this),this._email.get("attachments").off(null,this)),this._email=n,this._email.get("attachments").on("change",function(){this._renderAttachments()},this),e("#"+this._id+" .from").text(r._email.get("from")),t(["to","cc","bcc","subject"]).each(function(e){r._email.on("set:"+e,function(t){r._getEmailInput(e).val(t)},r),r._getEmailInput(e).blur(function(t){r._email.set(e,t.target.value)}).val(r._email.get(e)).prop("disabled",!r._isEditMode)}),n.get("toTargetObjectName")?(e("#"+this._id+" .to").hide(),e("#"+r._id+" .target-name").text(n.get("toTargetObjectName"))):e("#"+this._id+" .target").hide();var o=e("#"+this._id+" .add-attachment .btn-group");this._isEditMode?o.show():o.hide()}},g.prototype._getEmailInput=function(t){return e("#"+this._id+" ."+t+"-input")},g.prototype._inititiate=function(r){var o=this;r=r||{};var c=r.fileUploader||{};e(n.render(u("email-modal"),{id:this._id})).appendTo(this.parent),e("#"+o._id+" .close-modal").click(t.debounce(t(this._close).bind(this),1e3,!0)),this._fileUploader=new i({iframeContainerId:this._id+"_fileUploader",buttonHeight:"32px",buttonWidth:"133px",serviceId:this._id+"_service",fileObjectType:"attachment",fileSelectionCallback:t.bind(this._fileSelected,this),fileUploadedCallback:t.bind(this._fileUploaded,this),deletedCallback:t.bind(this._fileDeleted,this),storageLocation:c.storageLocation,fileDescription:c.description||""}),this._documentDialog=new a("document-dialog",{parent:this.parent,sizeLimit:h}).on("SELECTED",this._documentsSelected,this),this._attachmentsDialog=new s("attachments-dialog",r.attachments.primaryObject,{parent:this.parent,sizeLimit:h}).on("SELECTED",this._attachmentsSelected,this),t(["cc","bcc"]).each(function(t){var n=e("#"+o._id+" div."+t),i=e("#"+o._id+" a."+t);i.click(function(e){e.preventDefault(),n.toggle()})}),e("#"+this._id+" .from-salesforce").click(t.bind(function(e){e.preventDefault(),this._documentDialog.show([])},this)),e("#"+this._id+" .notes-attachments").click(t.bind(function(e){e.preventDefault(),this._attachmentsDialog.show([])},this)),e("#"+this._id).keyup(function(e){27===e.which&&(e.preventDefault(),o._close())}),this._messages=new d(e("#"+this._id+" .messages"))},g.prototype._close=function(){var i=this._validateInputs(),r=0!==i.length;if(r){var o="The following errors were found. Please correct them before continuing.<br/><br/>";t(i).each(function(e){o=o+"• "+e}),this._messages.clearError(),this._messages.addError(o)}else if(this._uploading.isUploading()){var s=this._uploading.get();this._messages.clearWarning(s.id),this._messages.addWarning(n.render(u("close-while-uploading-message"),{filename:s.name}),s.id),e("#"+this._id+" .cancel-upload").click(t.bind(function(e){e.preventDefault(),this._fileUploader.cancelUpload(),this._removeUploading(),this._forceClose()},this))}else this._forceClose()},g.prototype._validateInputs=function(){var n=[],i={storageName:"Storage Name cannot be empty."},r=this;return t(i).each(function(t,i){var o="#"+r._id+" div."+i;if(e(o+" input").is(":visible")){var s=e.trim(e(o+" input").val()).length;0===s&&(n.push(t),e(o).addClass("has-error"))}}),n},g.prototype._forceClose=function(){e("#"+this._id).modal("hide"),this._messages.clear(),e("#"+this._id+" div").removeClass("has-error"),this.fire("close")},g.prototype._generateId=function(e){return this._id+"-"+e.replace(/ /gi,"_").replace(/./gi,"-")},g.prototype._renderAddresses=function(){var n,i=this;t(["cc","bcc"]).each(function(t){n=e("#"+i._id+" a."+t),i._email.get(t)?n.hide():(n.show(),e("#"+i._id+" div."+t).hide())})},g.prototype._renderAttachments=function(){var i=this,r=u("uploading"),o=n.compile(u("attachment")),s=e("#"+this._id+" .attachments").empty();this._uploading.isUploading()&&e(r).appendTo(s),t.chain(this._email.get("attachments")).map(t.identity).reverse().each(function(t){var n=t.get("document").val();t.isSalesforceDocument()&&(n.name=n.name+"."+n.type);var r={id:i._id+"_"+n.name+"_"+n.id,document:n,attachmentUrl:l.location.origin+"/servlet/servlet.FileDownload?file="+n.id},a=e(o(r)).appendTo(s);a.data("attachment",t);var d=a.find("button.remove");t.get("isInaccessible")||!i._isEditMode?d.remove():d.click(function(e){e.preventDefault(),i.removeAttachment(t)})})},g.prototype.removeAttachment=function(e){if(e.uploaded){if(!this._removingUploadedAttachment){this._removingUploadedAttachment=!0;var t=e.get("document"),n=t.get("id");this._docsToDelete[n]=t.get("name"),this._fileUploader.deleteFile(n),this._email.removeAttachment(e)}}else this._email.removeAttachment(e)},g.prototype._fileSelected=function(e){e.event.status===!0?(this._addUploading(e.params.docName),this._renderAttachments()):this._messages.addError(e.event.message)},g.prototype._fileUploaded=function(e){var t=this._removeUploading();if(this._messages.clearWarning(t.id),e.event.status===!0){var n=p.createDraftAttachment({document:new f({id:e.params.docId,name:e.params.docName})});n.uploaded=!0,this._email.addAttachment(n)}else this._renderAttachments(),this._messages.addError("Error uploading "+t.name+":<br/>"+e.event.message)},g.prototype._fileDeleted=function(e){var t,n;e.event.status!==!0?(t=e.event.details.docId,n=this._docsToDelete[t],this._messages.addError('Error deleting <a href="'+l.location.origin+"/"+t+'">'+n+"</a>:<br/>"+e.event.message)):(t=e.params.docId,n=this._docsToDelete[t],delete this._docsToDelete[t]),this._removingUploadedAttachment=!1},g.prototype._documentsSelected=function(e){var n=t(e).map(function(e){return new p({document:new f({id:e.Id,name:e.Name,type:e.Type,contentType:e.ContentType})})});this._email.get("attachments").pushAll(n)},g.prototype._attachmentsSelected=function(e){var n=t(e).map(function(e){return p.createObjectAttachment({document:new f({id:e.Id,name:e.Name})})});this._email.get("attachments").pushAll(n)},g}),Thunderhead.SF.define("salesforce1_publisherActionWidget",["thirdParty_jQuery","thirdParty_underscore","thirdParty_mustache","generalSettings","session","browser","remoteDocumentGenerator","salesforce1_messages","salesforce1_jobMessages"],function(e,t,n,i,r,o,s,a,d,c,l){"use strict";var u=l.sforce.one,h=l.Sfdc.canvas.publisher,f=function(n,i){this._objectId=n;var r=!1;if(this._onSubmit=this._generateDocument,e(".th-select-docsettings").find("option").each(function(){i[this.value].validForSalesforce1?r||(r=!0,e(".th-select-docsettings").val(this.value)):e(this).hide()}),r)try{h.publish({name:"publisher.setValidForSubmit",payload:!0}),h.subscribe({name:"publisher.post",onData:t.bind(this._submit,this)})}catch(o){this._showMessage(o.payload)}else this._showError(e("<span>No documents for this page</span>"));e("#th_widget").show(),l.pubAction=this};return f.prototype={_submit:function(){this._onSubmit()},_generateDocument:function(){var n=e(".th-select-docsettings").val(),i={action:"generate",clientContext:7,docSettingId:n,objectId:this._objectId,isServiceConsole:!1,consoleTabId:""};s.generateWithContext(i).done(t.bind(this._afterRemoteAction,this)).fail(t.bind(this._showEventMessage,this)),this._beforeRemoteAction()},_beforeRemoteAction:function(){h.publish({name:"publisher.setValidForSubmit",payload:!1}),e("#th-gen-controls").hide(),e("#th-gen-error").hide(),e("#th-gen-spinner").show()},_afterRemoteAction:function(e){h.publish({name:"publisher.setValidForSubmit",payload:!1});var t=e.nextAction;return"SHOW_MESSAGES"===t?this._showJobMessages(e):("SHOW_PDF"===t&&this._showPDF(e),void this._closePublisherAction())},_showPDF:function(e){function n(e){return s+o.urlEncode(e)+l}var s=i.salesforceServicesUrl,a=r.sessionId,d=o.urlEncode(i.partnerServerUrl),c=r.userId,l="&sessionid="+a+"&url="+d+"&userid="+c;try{t(e.documentPackage.Envelopes).each(function(e){u.navigateToURL(n(e.MasterDocument.Location))})}catch(h){this._showMessage(h.payload)}},_closePublisherAction:function(){h.publish({name:"publisher.close",payload:{refresh:"true"}})},_showJobMessages:function(e){var n=e.documentPackage.Messages,i=t(n).find(function(e){return"E"===e.MessageType}),r=new d(n).on("back",t(this._closePublisherAction).bind(this));h.publish({name:"publisher.setValidForSubmit",payload:!i}),i||(this._onSubmit=t(this._processDocumentPackage).bind(this,e),r.on("continue",this._onSubmit)),this._showError(r.$)},_processDocumentPackage:function(e){s.processDocumentPackage(e).done(t.bind(this._afterRemoteAction,this)).fail(t.bind(this._showEventMessage,this)),this._beforeRemoteAction()},_showMessage:function(e){h.publish({name:"publisher.setValidForSubmit",payload:!1});var n=new a(e).on("back",t(this._closePublisherAction).bind(this)).$;this._showError(n)},_showEventMessage:function(e){this._showMessage(e.message)},_showError:function(t){e("#th-gen-error-message").empty().append(t),e("#th-gen-controls").hide(),e("#th-gen-spinner").hide(),e("#th-gen-error").show()}},f}),Thunderhead.SF.define("visualforce_sfConsole",function(e,t){"use strict";return t.sforce.console}),Thunderhead.SF.define("docgen_docgen",["thirdParty_jQuery","visualforce_sfConsole","browser","ui_messages","generalSettings","ui_jobMessages","documentProcessor"],function(e,t,n,i,r,o,s,a,d){"use strict";function c(){e("#docgen_container .logo_container").show()}function l(){e("#docgen_container .logo_container").hide()}function u(t){t&&c(),e("#docgen_container .spinner").show()}function h(t){e("#docgen_container .spinner").hide(),t&&l()}function f(){h(!0),e(".initialise_user").empty(),e("#docgen_container .messages").empty()}function p(e){h(!1),o.getMessageTable(e.documentPackage.Messages,"#docgen_container .messages")}function _(n){c();var i='<br/><br/><div align="center">Document generation completed.</div>';e("#docgen_container .messages").html(i),t.refreshSubtabById(n,!1),d.setTimeout(function(){var e=function(e){t.closeTab(e.id)};t.getEnclosingTabId(e)},3e3)}function g(e){var t=e||s.getGenerationContext();t.isServiceConsole?(f(),_(t.consoleTabId)):n.redirect(t.redirectUrlIsUserSpecified?t.redirectUrl:t.redirectUrl?t.redirectUrl:"/"+t.objectId)}function m(){var e=s.getGenerationContext();if(null===e){var t=n.getUrlParams();e={isServiceConsole:"true"===t.console,consoleTabId:t.consoleTabId,objectId:t.objectId}}g(e)}function v(t){f();var r=s.getGenerationContext();if(null===r){var o=n.getUrlParams();r={objectId:o.objectId}}var a=r.objectId?i.buildErrorHtml(t.message)+'<div align="center"><input class="btn back-button" value="Back" type="button"/></div>':i.buildErrorHtml(t.message);e(a).appendTo("#docgen_container .messages").find(".back-button").click(m)}function b(){f(),u(!0),s.processDocumentPackage().done(function(){s.nextAction()}).fail(function(e,t){v(t)})}function y(){e(".initialise_user").empty();var t='<iframe id="user_iframe" src="'+r.dashboardAuthUrl+'" height="0px" width="0px" />';e(".initialise_user").append(t);var n="<span>Initializing for first use...</span>";e(".initialise_user").append(n),d.setTimeout(function(){b()},5e3)}function D(e){u(!0),s.generate(e).done(function(e){s.generationContext=e,"SHOW_MESSAGES"===e.nextAction?p(e):e.userNotFoundReported?y():s.nextAction(e)}).fail(function(e,t){v(t)})}s.on("COMPLETE",g);var E={init:D,returnToRecord:m,completeGeneration:g,showSpinner:u,hideSpinner:h,showLogo:c,hideLogo:l,processPackage:b,showErrors:v,closeConsoleTab:_};return E}),Thunderhead.SF.define("docedt_docedt",["thirdParty_jQuery","thirdParty_underscore","thunderhead","documentProcessor","docedt_remoteDrafts","session","generalSettings","ui_messages","ui_resize","docedt_emailModels","docedt_storageModels","docedt_draftModels","docedt_emailDialog","docedt_documentDialog","docgen_docgen","ui_jobMessages","browser","docedt_approvalProcess"],function(e,t,n,i,r,o,s,a,d,c,l,u,h,f,p,_,g,m,v,b){"use strict";var y,D=n.DraftEditor,E=c.Email,T=l.Storage,S=u.Draft,w=function(t,n,i){var a=this,c="draftEditor",l="sessionid="+o.sessionIdURLEncoded+"&url="+s.partnerServerUrl+"&userid="+o.userId,u="Your session has expired. Refresh page and re-submit request. You may want to copy your changes";r.events.on("session-expired",function(){a._hideLoadingSpinner(),a._showErrorMessage(u)}),this._eventBroadcaster=i,D.prototype.DRAFTEDITOR_CONTEXT="/"+s.thinstanceContext+"/draft-editor",this._draftEditorDeferred=e.Deferred();var h;h=this._draftEditor=new D({thunderheadServer:s.draftEditorServerUrl,clientServer:s.salesforceBaseUrl,clientProxyURL:s.draftEditorClientProxyUrl,targetElementID:c,extTheme:"xtheme-gray",authUrl:s.authUrl,authParams:l,loadStartupConfig:function(){return{webServiceRoot:"/"+s.thinstanceContext+"/clientServices/",titleBar:{disabled:!0},sidePanel:{width:300,open:"DataValues"}}},onReady:function(){a._draftEditorDeferred.resolve(h)}}),e("#draftEditor").css("height",0),h.setTimeout(this._draftEditorTimeout),b.setTimeout(function(){a._draftEditorDeferred.reject("The Draft Editor could not be loaded")},this._draftEditorTimeout),this._draftEditorDeferred.fail(function(){a._resizer.resizeElement()}),h.addListener("dirty",function(e){this._dirty=this._dirty||e},this),this._resizer=new d(c,n),v.dev&&(v.dev.draftEditorController=this)};return w.prototype={_draftEditorTimeout:6e4,email:null,_resizer:null,_draftEditor:null,_draftEditorLoaded:!1,_draftEditorDeferred:null,_draftId:null,_draftModel:null,_afterSaveDraftXMLCB:null,_collaborate:!1,_closeDraft:null,_dirty:!1,getDraftDTO:function(){return this._draftModel?this._draftModel.toDTO():null},getEmailDTO:function(){var e=this._draftModel.get("emailInfo");return e?e.toDTO():null},isDirty:function(){return this._dirty},loadDraft:function(n){this._draftId=n,g.setDraftIdHash(n);var i=t(function(e,n){return this._onDraftLoaded(e),this._loadDraftInEditor(e,n).always(t(this._onDraftLoadedInEditor).bind(this))}).bind(this),r=t(function(e){p.hideSpinner(!0),this._showErrorMessage(e)}).bind(this);return this._beforeLoading(),e.when(this._getDraft(n),this._draftEditorDeferred).then(i,r)},_getDraft:function(e){return r.getDraftObject(e).pipe(function(e){return e},function(e){return e.message})},_onDraftLoaded:function(e){this._draftModel=S.fromDTO(e),this._dirty=!1;var n=this._draftModel.isEditMode()?"defaultMode":"readOnly";p.hideSpinner(!0),this._renderDraftEditorContainer(),this._draftEditor.setEditMode(n),t.chain(this._handleDraft).bind(this).defer(),t.chain(this._eventBroadcaster.fire).bind(this._eventBroadcaster,"DRAFT_LOADED",this._draftModel).defer()},_renderDraftEditorContainer:function(){var t=this,n=this._draftModel,i=n.isEditMode(),r=!!n.get("emailInfo");e("#draftTitle").empty().append(n.get("documentTitle")),e("#reload_button").hide();var o=n.get("storageInfo"),s=o.get("allowStorageNameChange");this._configureButton(n.get("canDelete"),"delete",function(){b.confirm("Are you sure you wish to delete this draft?")&&t.deleteDraft()}),this._configureButton(n.get("canRevise"),"revise",function(){t.reviseDraft()}),this._configureButton(i,"save",function(){t.saveDraft()}),this._configureButton(i,"saveclose",function(){t._closeDraft=!0,t.saveDraft()}),this._configureButton(n.get("canGenerate"),"generate",function(){t.saveAndFinaliseDraft()}),this._configureButton(n.get("canCollaborate"),"collaborate",function(){t.saveAndFinaliseDraft(!0)}),this._configureButton(r,"email_properties",function(){t._draftEditor.deactivate()}),this._configureButton(!r&&s,"document_properties",function(){t._draftEditor.deactivate()}),this._configureButton(!0,"reload",function(){t.reloadDraft()}),n.requiresApproval()&&this._handleApproval(),e("#draftEditorContainer").show()},_handleDraft:function(){this._draftModel&&(this._draftModel.get("emailInfo")?this._handleEmail(this._draftModel.get("emailInfo")):this._handleDocumentProperties(this._draftModel.get("storageInfo")),this._handleStorage(this._draftModel.get("storageInfo")))},_handleStorage:function(e){e.on("set",function(){this._dirty=!0},this);var t=null;this.docPropertiesDialog?t=this.docPropertiesDialog:this.emailDialog&&(t=this.emailDialog),t&&(e.get("allowStorageNameChange")?t.showStorage(e):t.hideStorage())},_handleStorageDTO:function(e){if(e){var t=T.fromDTO(e);this._draftModel.set("storageInfo",t,{silent:!0}),this._handleStorage(t)}},_loadDraftInEditor:function(t,n){var i=this,r=e.Deferred();return n.loadStringInProjectScope(t.xml,!1,s.projectId,function(e,t){e&&t?r.resolve():r.reject("The Draft failed to load."),i._afterLoaded()}),r.promise()},_hideDraftEditor:function(){e("#draftEditor").hide()},_showDraftEditor:function(){e("#draftEditor").show()},_onDraftLoadedInEditor:function(){this._draftEditorLoaded=!0,this._afterLoaded()},_configureButton:function(t,n,i){var r=e("#th_btn_"+n);t?r.unbind("click").click(i).show():r.hide()},_loadStorageInfo:function(e){var t=this;r.getStorageInfo(e).done(function(e){t._handleStorageDTO(e)}).fail(this._showMessageOnRemoteActionFailure("Unable to retrieve draft storage details!"))},_loadEmail:function(e){var t=this;r.getEmailHeaderInfo(e).done(function(e){t._handleEmailDTO(e)}).fail(this._showMessageOnRemoteActionFailure("Unable to retrieve draft attachments!"))},_handleEmailDTO:function(e){if(e){var t=E.fromDTO(e);this._draftModel.set("emailInfo",t,{silent:!0}),this._handleEmail(t)}},_handleDocumentProperties:function(t){var n=this;n.docProperties?n.docProperties.setDocProperties(t):(n.docPropertiesDialog=new f("document_dialog","#draft-editor-dialog",this._draftModel.isEditMode()),n.docPropertiesDialog.on("close",function(){n._draftEditor.activate()},n),e(".th_btn_document_properties").click(function(e){e.preventDefault(),n.docPropertiesDialog.show()}))},_handleEmail:function(t){if(t.on("set",function(){this._dirty=!0},this),this.emailDialog)this.emailDialog.setEmail(t,this._draftModel.isEditMode());else{var n={parent:"#draft-editor-dialog",fileUploader:{description:"Local attachments of draft "+this._draftModel.get("name")+":"+this._draftModel.get("documentTitle"),storageLocation:this._draftId},attachments:{primaryObject:{id:this._draftModel.get("primaryObjectId"),name:this._draftModel.get("primaryObjectName")}}};this.emailDialog=new h("email_dialog",t,n,this._draftModel.isEditMode()),this.emailDialog.on("uploading",function(e){e&&(this._dirty=!0)},this),this.emailDialog.on("close",function(){this._draftEditor.activate()},this)}e(".th_btn_email_properties").click(e.proxy(function(e){e.preventDefault(),this.emailDialog.show()},this))},_handleApproval:function(){m.init(this._draftModel,{relatedListTarget:"#draft-editor-approval-list",submitButton:"#th_btn_approval_submit"}),m.on("SUBMIT",function(){this._hideButtons(),this._showLoadingSpinner(),this._submitForApproval()},this)},_submitForApproval:function(){var n=this,i=this._draftModel,o=function(){var o=i.get("id");r.submitForApproval(o).done(function(r){return r.exception?void("REQUIRED_FIELD_MISSING"===r[r.exception]?g.redirect("/p/process/Submit?id="+o+"&retURL=%2F"+o):(e("#errorMessages").html(a.buildErrorHtml(r.exceptionMessage)),r.exception.indexOf("COMMON_EX_Exceptions.DraftApprovalException")>-1?n._hideLoadingSpinner():n._afterLoaded())):t.chain(n._eventBroadcaster.fire).bind(n._eventBroadcaster,"DRAFT_SUBMITTED_FOR_APPROVAL",o,i.get("primaryObjectId"),r.status).defer()}).fail(function(){n._afterLoaded(),e("#errorMessages").html(a.buildErrorHtml("There is no approval process for this draft"))})};this.isDirty()?this.saveDraft(function(){this._showSavedMessage(),o()},this):o()},_showMessageOnRemoteActionFailure:function(e){var t=this;return function(){t._showErrorMessage(e)}},reloadDraft:function(){e("#errorMessages").empty(),this._eventBroadcaster.fire("DRAFT_RELOAD",this._draftId)},reviseDraft:function(){var e=this;r.reviseDraft(this._draftId).done(function(t){e._eventBroadcaster.fire("DRAFT_REVISED",t),e.loadDraft(t)}).fail(this._showMessageOnRemoteActionFailure("Error revising draft!"))},deleteDraft:function(){var e=this,t=this._draftModel,n=t.get("emailInfo"),i=n?n.toDTO():null;r.deleteDraft(t.get("id"),i).done(function(n){e._eventBroadcaster.fire("DRAFT_DELETED",n,t.get("primaryObjectId"))}).fail(function(t){var n=t.message;e._showErrorMessage(n)})},resizeDraftEditor:function(){this._draftEditorLoaded&&this._resizer.resizeElement()},back:function(){e(".finalise_progress").hide(),e("#pageMessagePanel").hide(),e("#draft_container").show(),e("#draftEditorContainer").show(),this._showDraftEditor(),this._afterLoaded(),this.resizeDraftEditor()},saveAndFinaliseDraft:function(e){this._beforeLoading();var n=t.bind(this._finaliseDraft,this,!!e);this._draftModel.isEditMode()&&this.isDirty()?this.saveDraft(n):n()},saveDraft:function(n,i){this._dirty=!1,this._clearErrorMessage(),e("#pageMessagePanel").hide(),this.resizeDraftEditor(),this._afterSaveDraftXMLCB=n?t(n).bind(i||this):t(function(){this._afterLoaded(),this._showSavedMessage()}).bind(this),this._beforeLoading(),this._draftEditor.getString(function(e,t){e&&t&&0!==t.indexOf("[ERROR]")?this._persistDraft(t):(this._showErrorMessage("Unable to retrieve Draft XML from editor!"),this._afterLoaded())},this)},_persistDraft:function(e){var t=this;this._draftModel.set("xml",e.replace("UTF-16","UTF-8").replace("\n","&#10;").replace("\r","&#13;"),{silent:!0}),r.saveDraft(this.getDraftDTO()).done(function(e){t._onDraftSaved(e)}).fail(function(e){var n=e.message;t._hideLoadingSpinner(),e.name&&"Draft Service Error"===e.name?t._afterLoaded():n="Unable to save draft to repository! You may want to copy your changes. "+n,t._showErrorMessage(n)})},_onDraftSaved:function(t){200===t.statuscode?(this._updateDraftInfo(t),this._afterSaveDraftXMLCB()):(this._hideLoadingSpinner(),409===t.statuscode||403===t.statuscode?e("#reload_button").show():404!==t.statuscode&&this._showButtons(),this._showErrorMessage(t.errormessage)),this._closeDraft&&this._eventBroadcaster.fire("DRAFT_CLOSE",this._draftModel.get("primaryObjectId"))},_updateDraftInfo:function(t){this._draftModel.set("lastModified",t.lastmodified);var n=this._draftModel.get("id");this._draftModel.get("emailInfo")&&(e(".th_btn_email_properties").attr("disabled","disabled"),this._loadStorageInfo(n),this._loadEmail(n),e(".th_btn_email_properties").removeAttr("disabled"))},_finaliseDraft:function(t){var n=this;i.finaliseDraft(t,this._draftModel.get("lastModified")).done(function(t){n._hideLoadingSpinner(),n._hideDraftEditor(),e("#draftEditorContainer").hide(),p.showSpinner(!0),"SHOW_MESSAGES"===t.nextAction?(p.hideSpinner(!1),n._showJobMessage(t)):("SHOW_PDF"===t.nextAction||"COLLABORATE"===t.nextAction||"DOCUSIGN"===t.nextAction)&&p.hideSpinner(!0)}).fail(function(t,i){n._hideLoadingSpinner(),p.hideSpinner(!0),n._showErrorMessage(i.message),-1!==i.message.indexOf("Please refresh the page.")?(n._hideButtons(),e("#reload_button").show()):"This Draft has been deleted."===i.message?n._hideButtons():(n._showButtons(),n.back())})},_showErrorMessage:function(t){e("#errorMessages").html(a.buildErrorHtml(t))},_showJobMessage:function(e){_.getMessageTable(e.documentPackage.Messages,"#messages")},_clearErrorMessage:function(){e("#errorMessages").html("")},_showSavedMessage:function(){e("#vf_container").prepend('<div id="saved_bar">Saved</div>'),e("#saved_bar").delay(2e3).slideUp()},_beforeLoading:function(){e(".drop_down_area").hide(),this._hideButtons(),this._showLoadingSpinner()},_afterLoaded:function(){this._hideLoadingSpinner(),this._showButtons(),this.resizeDraftEditor()},_hideButtons:function(){e("#draftEditorContainer .buttons").hide()},_showButtons:function(){e("#draftEditorContainer .buttons").show()},_showLoadingSpinner:function(){e("#draftEditorContainer .loading").show()},_hideLoadingSpinner:function(){e("#draftEditorContainer .loading").hide()}},y={_draftEditorController:null,init:function(t,n){var i;i=y._draftEditorController=new w(t,n,y),v.extend(b,{back:function(){i.back()},onbeforeunload:function(){return i.isDirty()?"You will lose all your changes, are you sure you want to leave this page?":void 0}}),b.onresize=function(){i.resizeDraftEditor()},e(".email_subject").keypress(function(){e(this).val().length>100&&e(this).val(e(this).val().substr(0,100))}),e(".email_addresses").keypress(function(){e(this).val().length>2e3&&e(this).val(e(this).val().substr(0,2e3))})},loadDraft:function(e){y._draftEditorController.loadDraft(e)},show:function(){y._draftEditorController._showButtons(),y._draftEditorController.back()}},v.mixinObservable(y)}),Thunderhead.SF.define("docedt_chatterDropdown",["thirdParty_jQuery","thirdParty_mustache","generalSettings","ui_dropdown","docedt_docedt"],function(e,t,n,i,r){"use strict";return{init:function(o,s,a){var d=e(t.render(e("#chatter-dropdown-area_tmpl").html(),{id:s}));e("#"+s).replaceWith(d),i(o,d,"chatter-menu-button",a),r.on("DRAFT_LOADED",function(t){if(!t.isEditMode())return void e("#"+o).hide();var i="/apex/"+n.orgNamespace+"CHATTR_Post?draftRecordId="+t.get("id")+"&attachmentId="+t.get("attachmentId")+"&docSettingId="+t.get("docSettingId")+"&objectId="+t.get("primaryObjectId"),r="/apex/"+n.orgNamespace+"CHATTR_Feed?recordId="+t.get("id");e("#post-tab_"+s+" iframe").attr("src",i),d.find(".tab_content").hide();var a=d.find(".active_tab").attr("href");e(a).show(),d.find(".tab").click(function(){d.find(".tab").removeClass("active_tab"),e(this).addClass("active_tab");var t=e(this).attr("href");d.find(".tab_content").hide(),e(t).show();var n=e(t+" iframe").attr("src");n||0!==t.indexOf("#frame-tab")||(e(t+" iframe").attr("src",r),e(t+" iframe").attr("style","width:0px;height:0px;"),e(t+" img").show())}),e("#"+o).show()})}}}),Thunderhead.SF.define("docgen_collaborate",["thirdParty_jQuery","visualforce_sfConsole","browser","session","generalSettings","ui_messages","docgen_docgen","docgen_remoteDocbox","documentProcessor","ui_resize"],function(e,t,n,i,r,o,s,a,d,c,l,u){"use strict";function h(){if(!g){var e=m||"false"===n.getUrlParams().showHeader;g=new c("collab_iframe",e?c.CONSOLE_FOOTER_HEIGHT:c.DEFAULT_FOOTER_HEIGHT)}return g}function f(i,r){s.hideSpinner(!0),e("#collab_messages").hide(),m&&(t.setTabTitle(r),t.setTabLink());var o=i+"&sessionid="+v+"&url="+n.urlEncode(y)+"&userid="+b,a='<iframe id="collab_iframe" src="'+o+'" width="100%" style="border: none"/>';e("#collab_container").empty().append(a),g=h(),g.resizeElement()}function p(t){s.hideSpinner(!0),e(o.buildErrorHtml(t.message)).appendTo("#collab_messages")}function _(t){s.showSpinner(!0),n.setDocboxIdHash(t.docboxId),t.collaborateDocboxUrl?(m=t.isServiceConsole,f(t.collaborateDocboxUrl,t.consoleTabTitle)):a.loadDocbox(t.docboxId).done(function(t){e("#collab_messages").hide(),f(t,"")}).fail(function(t){e("#collab_container").hide(),p(t)})}var g,m,v=i.sessionIdURLEncoded,b=i.userId,y=r.partnerServerUrl;e(function(){d.on("COLLABORATE",_,this)}),e(u).resize(function(){e("#collab_iframe").is(":visible")&&(g=h(),g.resizeElement())})}),Thunderhead.SF.define("docgen_docusign",["thirdParty_jQuery","visualforce_sfConsole","documentProcessor","docgen_docgen","ui_resize"],function(e,t,n,i,r,o,s){"use strict";
function a(){return c||(c=new r("ds_iframe",r.DEFAULT_FOOTER_HEIGHT)),c}function d(t){i.hideSpinner(!0);var n=decodeURIComponent(t.docusignUrl),r='<iframe id="ds_iframe" src="'+n+'" width="100%" style="border: none"/>';e("#ds_container").empty().append(r),c=a(),c.resizeElement()}var c;e(s).resize(function(){e("#ds_iframe").is(":visible")&&(c=a(),c.resizeElement())}),n.on("DOCUSIGN",d,this)}),Thunderhead.SF.define("docgen_preview",["thirdParty_jQuery","thirdParty_underscore","visualforce_sfConsole","browser","session","generalSettings","documentProcessor","docgen_docgen","ui_resize"],function(e,t,n,i,r,o,s,a,d,c,l){"use strict";function u(){I=!1,s.complete()}function h(){I=!1,s.echoSign()}function f(t){t.showESign?(e("#th_btn_finish_primary").hide(),e("#th_btn_finish_secondary").click(u),e("#th_btn_esign").click(h)):(e("#th_btn_finish_primary").click(u),e("#th_btn_finish_secondary").hide(),e("#th_btn_esign").hide())}function p(e){return w+i.urlEncode(e)}function _(e){var t=e+"&sessionid="+E+"&url="+S+"&userid="+T;l.document.getElementById("th_iframe_pdfviewer").src=t}function g(e,t,n){return function(){_(e),n.setText(t);var i=l.document.getElementById("titleText");i.innerHTML=t}}function m(i){var r=i.MasterDocument,o=i.Enclosures||[],s=t([r].concat(o)).map(function(e){return{location:p(e.Location),name:e.DocumentName}}),a=l.document.getElementById("titleText");a.innerHTML=s[0].name,n.isInConsole()&&n.setTabTitle(a.innerHTML);var d;if(o.length>0){d=l.Ext.create("Ext.button.Split",{renderTo:"documentListDropdown",text:s[0].name,id:"doc-list-btn",handler:function(e,t){this.showMenu(t)},height:27,border:!1,hidden:!0,ui:"tertiary",menu:new l.Ext.menu.Menu({plain:!0,shadow:!1,border:!1,bodyBorder:!1,margin:"5 5 5 5",id:"doc-menu-btn",ui:"tertiary",showSeparator:!1})});var c,u=d.menu;for(c=0;c<s.length;c+=1)u.add({activeCls:"docItemActiveClass",border:!1,text:s[c].name,handler:g(s[c].location,s[c].name,d)});d.setVisible(!0);var h;d.addListener("menushow",function(){e.browser.msie&&(void 0===h?(h=u.getEl().createShim(),h.setBox(u.getEl().getBox()),h.setStyle("z-index","1"),h.setLeftTop(d.getPosition()[0],d.getPosition()[1]+5+d.getHeight())):(h.setLeft(d.getPosition()[0]),h.setDisplayed(!0)))}),d.addListener("menuhide",function(){e.browser.msie&&void 0!==h&&h.setDisplayed(!1)}),e("#doclistspan").show()}else e("#doclistspan").hide()}function v(){return I?"You will not be able to return to this document!":void 0}function b(t){e("#show_pdf").show();var n=new d("pdfViewer",t?d.CONSOLE_FOOTER_HEIGHT:d.DEFAULT_FOOTER_HEIGHT);n.resizeElement(),l.onresize=function(){n.resizeElement()}}function y(t,n){var r=n.MasterDocument,o=p(r.Location);l.onbeforeunload=v;var s=o+"&sessionid="+E+"&url="+i.urlEncode(S)+"&userid="+T;l.loadPDFViewer=function(){b()};var a='<iframe src="'+s+'" frameborder="0" height="100%" id="th_iframe_pdfviewer" name="th_iframe_pdfviewer" scrolling="no" title="Content" width="100%" html-onload="loadPDFViewer();"></iframe>';e("#pdfViewer").empty().append(a),b(t.isServiceConsole)}function D(e){a.hideSpinner(!0);var t=e.documentPackage.Envelopes[0];f(e),m(t),y(e,t)}var E=r.sessionIdURLEncoded,T=r.userId,S=o.partnerServerUrl,w=o.salesforceServicesUrl,I=!0;s.on("SHOW_PDF",D,this)}),Thunderhead.SF.define("pages_editDocument",["thirdParty_jQuery","visualforce_sfConsole","browser","ui_resize","documentProcessor","docedt_docedt","docgen_docgen","ui_jobMessages","features","ui_messages"],function(e,t,n,i,r,o,s,a,d,c,l,u){"use strict";return function(l){var h="true"===l.console,f="true"===l.console||"false"===l.showHeader,p=l.returnTo,_={action:l.action,docSettingId:l.docSettingId,objectId:l.objectId,isServiceConsole:h,consoleTabId:l.consoleTabId||""},g=function(e,i){var o=r.getGenerationContext();h?_&&i?s.closeConsoleTab(_.consoleTabId):t.getEnclosingTabId(function(e){t.closeTab(e.id)}):n.redirect(o.redirectUrlIsUserSpecified||o.redirectUrl?o.redirectUrl:p&&"DRAFTSLIST"===p.toUpperCase()&&!i?"/apex/DRAFTS_DraftsList":"/"+e)};if(!d.draftEditingIsLicensed){s.hideSpinner(!0);var m=c.buildErrorHtml(d.draftEditingFeatureMessage);return void e("#editErrorMessage").empty().append(m)}var v=n.getDraftIdHash(),b=n.getDocboxIdHash();if(v)o.init(_,f?i.CONSOLE_FOOTER_HEIGHT:i.DEFAULT_FOOTER_HEIGHT),_.draftRecordId=v,r.generationContext=_,o.loadDraft(_.draftRecordId);else if(b)o.init(_,f?i.CONSOLE_FOOTER_HEIGHT:i.DEFAULT_FOOTER_HEIGHT),_.docboxId=b,r.fire("COLLABORATE",_);else{if(r.isGenerated(l.genId))return g(_.objectId,!0);o.init(_,f?i.CONSOLE_FOOTER_HEIGHT:i.DEFAULT_FOOTER_HEIGHT),l.id?(_.draftRecordId=l.id,r.generationContext=_,o.loadDraft(_.draftRecordId)):l.action?s.init(_):s.showErrors({message:"Creating drafts by this means is not supported."})}r.on("COMPLETE",function(e){g(e.objectId,!0)}),r.on("DRAFT_EDITOR",function(e){o.loadDraft(e.draftRecordId)}),o.on("DRAFT_LOADED",function(e){h&&(t.setTabTitle("Draft: "+e.get("documentTitle")),t.setTabLink())}),o.on("DRAFT_SUBMITTED_FOR_APPROVAL",function(e,t,i){if("Pending"===i)return g(t,!1);var r=u.location.pathname+"?id="+e;return p&&(r=r+"&returnTo="+p),n.redirect(r)}),o.on("DRAFT_REVISED",function(e){_={docSettingId:l.docSettingId,objectId:l.objectId,isServiceConsole:h,consoleTabId:l.consoleTabId||"",draftRecordId:e},r.generationContext=_}),o.on("DRAFT_RELOAD",function(e){o.loadDraft(e)}),o.on("DRAFT_CLOSE",function(e){g(e,!1)}),o.on("DRAFT_DELETED",function(e,t){u.onbeforeunload=null,g(t,!1)}),a.on("MESSAGES_CONTINUE",function(){s.processPackage()}),a.on("MESSAGES_BACK",function(){"finalise"===r.generationContext.action?(s.hideLogo(),a.clearContainer(),o.show()):s.returnToRecord()})}});